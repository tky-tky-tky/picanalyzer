{% extends "base/base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/table.css' %}">
  <link rel="stylesheet" href="{% static 'css/table_mobile.css' %}">
{% endblock %}

{% block body %}
<div class="forms">
  <br>
  <div class="description">この画像を削除しますか？</div>

  <!-- PC版 表 -->
  <form method="post" class="pc-only">
    {% csrf_token %}
    <table class="image-table">
      <thead>
        <tr>
          <th>User</th>
          <th>Image</th>
          <th>Status</th>
          <th>Error Log</th>
          <th>Start</th>
          <th>Upload</th>
          <th>Finish</th>
          <th>Model</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ analysis.image.user.email }}</td>
          <td>
            {% if analysis.image.image %}
              <img src="{{ analysis.image.image.url }}" alt="image" class="thumbnail">
            {% else %}
              <span>No image</span>
            {% endif %}
          </td>
          <td>
            {% if analysis.status == "解析中" %}
              <span class="status-blue">解析中...</span>
            {% elif analysis.status == "成功" %}
              <span class="status-green">解析成功！</span>
            {% elif analysis.status == "失敗" %}
              <span class="status-red">失敗</span>
            {% else %}
              {{ analysis.status }}
          {% endif %}
          </td>
          <td>
            {% if analysis.error_log %}
            <details class="error-details">
              <summary><span class="status-red">{{ analysis.error_name }}</span></summary>
              <pre>{{ analysis.error_log }}</pre>
            </details>
            {% endif %}
          </td>
          <td>{{ analysis.image.uploaded_at|date:"Y/m/d H:i" }}</td>
          <td>{{ analysis.started_at|date:"Y/m/d H:i" }}</td>
          <td>{{ analysis.ended_at|date:"Y/m/d H:i" }}</td>
          <td>{{ analysis.model_name }}</td>
        </tr>
      </tbody>
    </table>

    <div class="button-group">
      <button type="submit" class="button">Delete</button>
      <a href="{% url 'adminpanel:pictures_manager' %}" class="button">Back</a>
    </div>
  </form>

  <!-- スマホ版 カード -->
  <form method="post" class="sp-only">
    {% csrf_token %}
    <div class="user-list">
      <div class="user-record-alt">

        <!-- 画像 -->
        <div class="row">
          <div class="cell full">
            {% if analysis.image.image %}
              <img src="{{ analysis.image.image.url }}" alt="image" class="thumbnail-large">
            {% else %}
              <span>No image</span>
            {% endif %}
          </div>
        </div>

        <!-- user / status -->
        <div class="row">
          <div class="cell">user</div>
          <div class="cell">status</div>
        </div>
        <div class="row">
          <div class="cell">{{ analysis.image.user.email }}</div>
          <div class="cell">
            {% if analysis.status == "解析中" %}
            <span class="status-blue">解析中...</span>
          {% elif analysis.status == "成功" %}
            <span class="status-green">解析成功！</span>
          {% elif analysis.status == "失敗" %}
            <span class="status-red">失敗</span>
          {% else %}
            {{ analysis.status }}
          {% endif %}</div>
        </div>

        <!-- upload / start / finish -->
        <div class="row">
          <div class="cell">upload</div>
          <div class="cell">start</div>
          <div class="cell">finish</div>
        </div>
        <div class="row">
          <div class="cell">{{ analysis.image.uploaded_at|date:"Y/m/d H:i"}}</div>
          <div class="cell">{{ analysis.started_at|date:"Y/m/d H:i"}}</div>
          <div class="cell">{{ analysis.ended_at|date:"Y/m/d H:i"}}</div>
        </div>

        <!-- error log / model -->
        <div class="row">
          <div class="cell">error log</div>
          <div class="cell">model</div>
        </div>
        <div class="row">
          <div class="cell">
            {% if analysis.error_log %}
              <details class="error-details">
                <summary><span class="status-red">{{ analysis.error_name }}</span></summary>
                <pre>{{ analysis.error_log }}</pre>
              </details>
            {% endif %}
          </div>
          <div class="cell">{{ analysis.model_name }}</div>
        </div>

        <!-- ボタン -->
        <div class="edit-button">
          <button type="submit" class="button">Delete</button>
          <a href="{% url 'adminpanel:pictures_manager' %}" class="button">Back</a>
        </div>
      </div>
    </div>
  </form>
</div>
{% endblock %}
